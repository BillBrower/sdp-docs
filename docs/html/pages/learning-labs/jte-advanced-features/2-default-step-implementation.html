

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Default Step Implementation &mdash; Solutions Delivery Platform  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Pipeline Lifecycle Hooks" href="3-pipeline-lifecycle-hooks.html" />
    <link rel="prev" title="Prerequisites" href="1-prerequisites.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> Solutions Delivery Platform
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Components</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://jenkinsci.github.io/templating-engine-plugin">Jenkins Templating Engine</a></li>
<li class="toctree-l1"><a class="reference external" href="https://boozallen.github.io/sdp-libraries">Pipeline Libraries</a></li>
</ul>
<p class="caption"><span class="caption-text">Deployment Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../deployment-guides/openshift/index.html">OpenShift</a></li>
</ul>
<p class="caption"><span class="caption-text">Learning Labs</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../try-it-out/docs/index.html">Try It Out</a></li>
<li class="toctree-l1"><a class="reference internal" href="../local-development/index.html">Local Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jte-the-basics/index.html">JTE: The Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../jte-primitives/index.html">JTE: Pipeline Primitives</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">JTE: Advanced Features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1-prerequisites.html">Prerequisites</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Default Step Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="3-pipeline-lifecycle-hooks.html">Pipeline Lifecycle Hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="4-multimethod-steps.html">Multi-Method Steps</a></li>
<li class="toctree-l2"><a class="reference internal" href="5-summary.html">Summary</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">How-To Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/helm-multitenancy.html">Helm Multitenancy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to/add_jenkins_credentials.html">Add Credentials to Jenkins</a></li>
<li class="toctree-l1"><a class="reference external" href="https://help.github.com/articles/creating-a-new-organization-from-scratch/">Create a GitHub Organization</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.twistlock.com/2018/05/08/securing-containers-red-hat-openshift-twistlock-deployment-script/">Deploy Twistlock to OpenShift</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Solutions Delivery Platform</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">JTE: Advanced Features</a> &raquo;</li>
        
      <li>Default Step Implementation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../../_sources/pages/learning-labs/jte-advanced-features/2-default-step-implementation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="default-step-implementation">
<span id="jte-advanced-features-default-step-implementation"></span><h1>Default Step Implementation<a class="headerlink" href="#default-step-implementation" title="Permalink to this headline">¶</a></h1>
<p>There are a large number of use cases where a step contributed by library is
going to do the same thing:</p>
<ol class="arabic simple">
<li>Check out the source code</li>
<li>Run some CLI command</li>
<li>Archive some files that were generated by the command</li>
</ol>
<p>To support fast development of steps that follow this pattern, the <a class="reference external" href="https://jenkinsci.github.io/templating-engine-plugin/pages/Primitives/default_step_implementation.html">default
step implementation</a>
is available.</p>
<div class="section" id="what-is-the-default-step-implementation">
<h2>What is the Default Step Implementation?<a class="headerlink" href="#what-is-the-default-step-implementation" title="Permalink to this headline">¶</a></h2>
<p>The default step implementation allows you to define a step from the Pipeline
Configuration that specifies a container image as the runtime environment for the step,
a shell command or script to execute, and then a stash to be created in order to store
files generated.</p>
<div class="section" id="benefits">
<h3>Benefits<a class="headerlink" href="#benefits" title="Permalink to this headline">¶</a></h3>
<p>1. The default step implementation allows a quick and dirty way to quickly prototype a step
on the fly without needing to create a library.</p>
<p>2. Using container images for pipeline runtime dependencies is an excellent way to build a
DevSecOps pipeline that is loosely coupled to the underlying infrastructure.</p>
</div>
<div class="section" id="setbacks">
<h3>Setbacks<a class="headerlink" href="#setbacks" title="Permalink to this headline">¶</a></h3>
<p>1.  The default step implementation can be a little too powerful if you’re striving for a
tightly governed DevSecOps pipeline.  This feature should be exposed to end users with care.</p>
<p>2.  This feature hard codes a particular functionality from the Pipeline Configuration and does
not have the same configuration flexibility that a library would have.</p>
</div>
</div>
<div class="section" id="create-a-step">
<h2>Create a Step<a class="headerlink" href="#create-a-step" title="Permalink to this headline">¶</a></h2>
<p>In the same Pipeline Job we were using during the JTE: Pipeline Primtives lab, let’s add a
new step called <code class="docutils literal notranslate"><span class="pre">unit_test()</span></code>.</p>
<div class="section" id="update-the-pipeline-configuration">
<h3>Update the Pipeline Configuration<a class="headerlink" href="#update-the-pipeline-configuration" title="Permalink to this headline">¶</a></h3>
<p>Append to the Pipeline Configuration:</p>
<div class="code groovy highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">steps</span><span class="p">{</span>
    <span class="n">unit_test</span><span class="p">{</span>
        <span class="n">stage</span> <span class="o">=</span> <span class="s2">&quot;Unit Test&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="s2">&quot;maven&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;mvn -v&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p>Steps implemented through the default step implementation are defined in the
<code class="docutils literal notranslate"><span class="pre">steps</span></code> block of the Pipeline Configuration.</p>
<p class="last">Root level keys within the <code class="docutils literal notranslate"><span class="pre">steps</span></code> block become the <strong>name</strong> of the step
that can be invoked from the Pipeline Template.</p>
</div>
<p>The step above creates a <code class="docutils literal notranslate"><span class="pre">unit_test</span></code> step that can be invoked from the Pipeline
Template that executes the command <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">-v</span></code> inside the <code class="docutils literal notranslate"><span class="pre">maven:latest</span></code> container
image from Docker Hub.</p>
<p>It would also make sense to update the <code class="docutils literal notranslate"><span class="pre">continuous_integration</span></code> Stage that was created
to include the <code class="docutils literal notranslate"><span class="pre">unit_test</span></code> step:</p>
<div class="code groovy highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stages</span><span class="p">{</span>
    <span class="n">continuous_integration</span><span class="p">{</span>
        <span class="n">unit_test</span>
        <span class="n">build</span>
        <span class="n">static_code_analysis</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-the-pipeline">
<h2>Run the Pipeline<a class="headerlink" href="#run-the-pipeline" title="Permalink to this headline">¶</a></h2>
<p>Run the pipeline.  From the job’s main page, click <code class="docutils literal notranslate"><span class="pre">Build</span> <span class="pre">Now</span></code> in the lefthand navigation
menu.</p>
<p>View the build logs and you should see output similar to:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Started by user admin
Running in Durability level: MAX_SURVIVABILITY
[Pipeline] Start of Pipeline
[JTE] Pipeline Configuration Modifications (show)
[JTE] Loading Library maven (show)
[JTE] Library maven does not have a configuration file.
[JTE] Loading Library sonarqube (show)
[JTE] Library sonarqube does not have a configuration file.
[JTE] Loading Library ansible (show)
[JTE] Library ansible does not have a configuration file.
[JTE] Creating step unit_test from the default step implementation.
[JTE] Obtained Pipeline Template from job configuration
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/single-job
[Pipeline] {
[Pipeline] writeFile
[Pipeline] archiveArtifacts
Archiving artifacts
[Pipeline] }
[Pipeline] // node
[JTE] [Stage - continuous_integration]
[JTE] [Step - Default Step Implementation/unit_test.call()]
[Pipeline] stage
[Pipeline] { (Unit Test)
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/single-job
[Pipeline] {
[Pipeline] isUnix
[Pipeline] sh
+ docker inspect -f . maven
.
[Pipeline] withDockerContainer
Jenkins seems to be running inside container cc7140d4fb91bef940e2fabe7225dcbcc9b44a3a5e17ee703b8fcbe42e53a17c
$ docker run -t -d -u 0:0 -w /var/jenkins_home/workspace/single-job --volumes-from cc7140d4fb91bef940e2fabe7225dcbcc9b44a3a5e17ee703b8fcbe42e53a17c -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** maven cat
$ docker top e41cf335bb258d366d9c5dc2a91090184d0bc00b207ccf10b125e035a3a5ede5 -eo pid,comm
[Pipeline] {
[Pipeline] unstash
[Pipeline] sh
+ mvn -v
Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)
Maven home: /usr/share/maven
Java version: 11.0.5, vendor: Oracle Corporation, runtime: /usr/local/openjdk-11
Default locale: en, platform encoding: UTF-8
OS name: &quot;linux&quot;, version: &quot;4.9.125-linuxkit&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;
[Pipeline] }
$ docker stop --time=1 e41cf335bb258d366d9c5dc2a91090184d0bc00b207ccf10b125e035a3a5ede5
$ docker rm -f e41cf335bb258d366d9c5dc2a91090184d0bc00b207ccf10b125e035a3a5ede5
[Pipeline] // withDockerContainer
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // stage
[JTE] [Step - maven/build.call()]
[Pipeline] stage
[Pipeline] { (Maven: Build)
[Pipeline] echo
build from the maven library
[Pipeline] }
[Pipeline] // stage
[JTE] [Step - sonarqube/static_code_analysis.call()]
[Pipeline] stage
[Pipeline] { (SonarQube: Static Code Analysis)
[Pipeline] echo
static code analysis from the sonarqube library
[Pipeline] }
[Pipeline] // stage
[JTE] [Step - ansible/deploy_to.call(ApplicationEnvironment)]
[Pipeline] stage
[Pipeline] { (Deploy To: dev)
[Pipeline] echo
performing a deployment through ansible..
[Pipeline] echo
deploying to 0.0.0.1
[Pipeline] echo
deploying to 0.0.0.2
[Pipeline] }
[Pipeline] // stage
[Pipeline] timeout
Timeout set to expire in 5 min 0 sec
[Pipeline] {
[Pipeline] input
Approve the deployment?
Proceed or Abort
Approved by admin
[Pipeline] }
[Pipeline] // timeout
[JTE] [Step - ansible/deploy_to.call(ApplicationEnvironment)]
[Pipeline] stage
[Pipeline] { (Deploy To: Production)
[Pipeline] echo
performing a deployment through ansible..
[Pipeline] echo
deploying to 0.0.1.1
[Pipeline] echo
deploying to 0.0.1.2
[Pipeline] echo
deploying to 0.0.1.3
[Pipeline] echo
deploying to 0.0.1.4
[Pipeline] }
[Pipeline] // stage
[Pipeline] End of Pipeline
Finished: SUCCESS
</pre></div>
</div>
<p>When reading the lines, notice:</p>
<p><code class="docutils literal notranslate"><span class="pre">[JTE]</span> <span class="pre">Creating</span> <span class="pre">step</span> <span class="pre">unit_test</span> <span class="pre">from</span> <span class="pre">the</span> <span class="pre">default</span> <span class="pre">step</span> <span class="pre">implementation.</span></code></p>
<p>at the beginning of the build.</p>
<p>JTE saw a step was defined in the Pipeline Configuration and constructed the <code class="docutils literal notranslate"><span class="pre">unit_test</span></code> step on the fly
for use in the Pipeline Template.</p>
<p>The logs pertaining to the <code class="docutils literal notranslate"><span class="pre">unit_test</span></code> step were:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[JTE] [Step - Default Step Implementation/unit_test.call()]
[Pipeline] stage
[Pipeline] { (Unit Test)
[Pipeline] node
Running on Jenkins in /var/jenkins_home/workspace/single-job
[Pipeline] {
[Pipeline] isUnix
[Pipeline] sh
+ docker inspect -f . maven
.
[Pipeline] withDockerContainer
Jenkins seems to be running inside container cc7140d4fb91bef940e2fabe7225dcbcc9b44a3a5e17ee703b8fcbe42e53a17c
$ docker run -t -d -u 0:0 -w /var/jenkins_home/workspace/single-job --volumes-from cc7140d4fb91bef940e2fabe7225dcbcc9b44a3a5e17ee703b8fcbe42e53a17c -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** -e ******** maven cat
$ docker top e41cf335bb258d366d9c5dc2a91090184d0bc00b207ccf10b125e035a3a5ede5 -eo pid,comm
[Pipeline] {
[Pipeline] unstash
[Pipeline] sh
+ mvn -v
Apache Maven 3.6.2 (40f52333136460af0dc0d7232c0dc0bcf0d9e117; 2019-08-27T15:06:16Z)
Maven home: /usr/share/maven
Java version: 11.0.5, vendor: Oracle Corporation, runtime: /usr/local/openjdk-11
Default locale: en, platform encoding: UTF-8
OS name: &quot;linux&quot;, version: &quot;4.9.125-linuxkit&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;
[Pipeline] }
$ docker stop --time=1 e41cf335bb258d366d9c5dc2a91090184d0bc00b207ccf10b125e035a3a5ede5
$ docker rm -f e41cf335bb258d366d9c5dc2a91090184d0bc00b207ccf10b125e035a3a5ede5
[Pipeline] // withDockerContainer
[Pipeline] }
[Pipeline] // node
[Pipeline] }
[Pipeline] // stage
</pre></div>
</div>
<p>You can see JTE announcing it’s about to execute a step called <code class="docutils literal notranslate"><span class="pre">unit_test</span></code> that was constructed via the
default step implementation here: <code class="docutils literal notranslate"><span class="pre">[JTE]</span> <span class="pre">[Step</span> <span class="pre">-</span> <span class="pre">Default</span> <span class="pre">Step</span> <span class="pre">Implementation/unit_test.call()]</span></code>.</p>
<p>When the step executed, it checked if the <code class="docutils literal notranslate"><span class="pre">maven</span></code> step was available locally and pulls the image if not.</p>
<p>Within it container image, it then ran <code class="docutils literal notranslate"><span class="pre">mvn</span> <span class="pre">-v</span></code> and the maven version was printed to the build log.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="3-pipeline-lifecycle-hooks.html" class="btn btn-neutral float-right" title="Pipeline Lifecycle Hooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="1-prerequisites.html" class="btn btn-neutral float-left" title="Prerequisites" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Booz Allen Hamilton

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-144247959-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>